<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Extensions of dplyr and fuzzyjoin Join Functions • powerjoin</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Extensions of dplyr and fuzzyjoin Join Functions">
<meta name="description" content="We extend dplyr and fuzzyjoin join functions with features to preprocess the data, apply various data checks, and deal with conflicting columns.">
<meta property="og:description" content="We extend dplyr and fuzzyjoin join functions with features to preprocess the data, apply various data checks, and deal with conflicting columns.">
<meta property="og:image" content="/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">powerjoin</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/moodymudskipper/powerjoin/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="powerjoin-">powerjoin <a class="anchor" aria-label="anchor" href="#powerjoin-"></a>
</h1>
</div>
<p>{powerjoin} extends {dplyr}’s join functions.</p>
<ul>
<li>Make your joins safer with the <code>check</code> argument and the <code><a href="reference/check_specs.html">check_specs()</a></code>function</li>
<li>Deal with conflicting column names by combining, coalescing them etc using the <code>conflict</code> argument</li>
<li>Preprocess input, for instance to select columns to join without having to repeat key columns in the selection</li>
<li>Do painless fuzzy joins thanks to a generalized <code>by</code> argument accepting formulas</li>
<li>Fill unmatched values using the <code>fill</code> argument</li>
<li>Operate recursive joins by providing lists of data frames to <code>x</code> and <code>y</code>
</li>
<li>Keep or drop key columns with more flexibility thanks to an enhanced <code>keep</code>argument</li>
</ul>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Install CRAN version with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"powerjoin"</span><span class="op">)</span></span></code></pre></div>
<p>Or development version with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"moodymudskipper/powerjoin"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="now-lets-match-penguins">Now let’s match penguins<a class="anchor" aria-label="anchor" href="#now-lets-match-penguins"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/moodymudskipper/powerjoin" class="external-link">powerjoin</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># toy dataset built from Allison Horst's {palmerpenguins} package and </span></span>
<span><span class="co"># Hadley Wickham's {babynames}</span></span>
<span></span>
<span><span class="va">male_penguins</span> <span class="op">&lt;-</span> <span class="fu">tribble</span><span class="op">(</span></span>
<span>     <span class="op">~</span><span class="va">name</span>,    <span class="op">~</span><span class="va">species</span>,     <span class="op">~</span><span class="va">island</span>, <span class="op">~</span><span class="va">flipper_length_mm</span>, <span class="op">~</span><span class="va">body_mass_g</span>,</span>
<span> <span class="st">"Giordan"</span>,    <span class="st">"Gentoo"</span>,    <span class="st">"Biscoe"</span>,               <span class="fl">222L</span>,        <span class="fl">5250L</span>,</span>
<span>  <span class="st">"Lynden"</span>,    <span class="st">"Adelie"</span>, <span class="st">"Torgersen"</span>,               <span class="fl">190L</span>,        <span class="fl">3900L</span>,</span>
<span>  <span class="st">"Reiner"</span>,    <span class="st">"Adelie"</span>,     <span class="st">"Dream"</span>,               <span class="fl">185L</span>,        <span class="fl">3650L</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">female_penguins</span> <span class="op">&lt;-</span> <span class="fu">tribble</span><span class="op">(</span></span>
<span>     <span class="op">~</span><span class="va">name</span>,    <span class="op">~</span><span class="va">species</span>,  <span class="op">~</span><span class="va">island</span>, <span class="op">~</span><span class="va">flipper_length_mm</span>, <span class="op">~</span><span class="va">body_mass_g</span>,</span>
<span>  <span class="st">"Alonda"</span>,    <span class="st">"Gentoo"</span>, <span class="st">"Biscoe"</span>,               <span class="fl">211</span>,        <span class="fl">4500L</span>,</span>
<span>     <span class="st">"Ola"</span>,    <span class="st">"Adelie"</span>,  <span class="st">"Dream"</span>,               <span class="fl">190</span>,        <span class="fl">3600L</span>,</span>
<span><span class="st">"Mishayla"</span>,    <span class="st">"Gentoo"</span>, <span class="st">"Biscoe"</span>,               <span class="fl">215</span>,        <span class="fl">4750L</span>,</span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="safer-joins">Safer joins<a class="anchor" aria-label="anchor" href="#safer-joins"></a>
</h2>
<p>The <code>check</code> argument receives an object created by the <code><a href="reference/check_specs.html">check_specs()</a></code> function, which provides ways to handle specific input properties, its arguments can be :</p>
<ul>
<li>
<code>"ignore"</code> : stay silent (default except for <code>implicit_keys</code>)</li>
<li><code>"inform"</code></li>
<li><code>"warn"</code></li>
<li><code>"abort"</code></li>
</ul>
<p>We can print these defaults :</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/check_specs.html">check_specs</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # powerjoin check specifications</span></span>
<span><span class="co">#&gt; ℹ implicit_keys</span></span>
<span><span class="co">#&gt; → column_conflict</span></span>
<span><span class="co">#&gt; → duplicate_keys_left</span></span>
<span><span class="co">#&gt; → duplicate_keys_right</span></span>
<span><span class="co">#&gt; → unmatched_keys_left</span></span>
<span><span class="co">#&gt; → unmatched_keys_right</span></span>
<span><span class="co">#&gt; → missing_key_combination_left</span></span>
<span><span class="co">#&gt; → missing_key_combination_right</span></span>
<span><span class="co">#&gt; → inconsistent_factor_levels</span></span>
<span><span class="co">#&gt; → inconsistent_type</span></span>
<span><span class="co">#&gt; → grouped_input</span></span>
<span><span class="co">#&gt; → na_keys</span></span></code></pre></div>
<p>By default it works like {dplyr}, informing in case of implicit keys, and no further checks :</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/power_left_join.html">power_inner_join</a></span><span class="op">(</span></span>
<span>  <span class="va">male_penguins</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species"</span>, <span class="st">"island"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="va">female_penguins</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species"</span>, <span class="st">"island"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining, by = c("species", "island")</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 2</span></span>
<span><span class="co">#&gt;   species island</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt; </span></span>
<span><span class="co">#&gt; 1 Gentoo  Biscoe</span></span>
<span><span class="co">#&gt; 2 Gentoo  Biscoe</span></span>
<span><span class="co">#&gt; 3 Adelie  Dream</span></span></code></pre></div>
<p>We can silence the implicit key detection and check that we have unique keys in the right table</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/check_specs.html">check_specs</a></span><span class="op">(</span>implicit_keys <span class="op">=</span> <span class="st">"ignore"</span>, duplicate_keys_right <span class="op">=</span> <span class="st">"abort"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # powerjoin check specifications</span></span>
<span><span class="co">#&gt; → implicit_keys</span></span>
<span><span class="co">#&gt; → column_conflict</span></span>
<span><span class="co">#&gt; → duplicate_keys_left</span></span>
<span><span class="co">#&gt; x duplicate_keys_right</span></span>
<span><span class="co">#&gt; → unmatched_keys_left</span></span>
<span><span class="co">#&gt; → unmatched_keys_right</span></span>
<span><span class="co">#&gt; → missing_key_combination_left</span></span>
<span><span class="co">#&gt; → missing_key_combination_right</span></span>
<span><span class="co">#&gt; → inconsistent_factor_levels</span></span>
<span><span class="co">#&gt; → inconsistent_type</span></span>
<span><span class="co">#&gt; → grouped_input</span></span>
<span><span class="co">#&gt; → na_keys</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/power_left_join.html">power_inner_join</a></span><span class="op">(</span></span>
<span>  <span class="va">male_penguins</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species"</span>, <span class="st">"island"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="va">female_penguins</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species"</span>, <span class="st">"island"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  check <span class="op">=</span> <span class="fu"><a href="reference/check_specs.html">check_specs</a></span><span class="op">(</span>implicit_keys <span class="op">=</span> <span class="st">"ignore"</span>, duplicate_keys_right <span class="op">=</span> <span class="st">"abort"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: Keys in the right table have duplicates:</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 2</span></span>
<span><span class="co">#&gt;   species island</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt; </span></span>
<span><span class="co">#&gt; 1 Gentoo  Biscoe</span></span></code></pre></div>
<p>The <code>column_conflict</code> argument guarantees that you won’t have columns renamed without you knowing, you might need it most of the time, we could setup some development and production specs for our most common joins:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dev_specs</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/check_specs.html">check_specs</a></span><span class="op">(</span></span>
<span>  column_conflict <span class="op">=</span> <span class="st">"abort"</span>,</span>
<span>  inconsistent_factor_levels <span class="op">=</span> <span class="st">"inform"</span>,</span>
<span>  inconsistent_type <span class="op">=</span> <span class="st">"inform"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">prod_specs</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/check_specs.html">check_specs</a></span><span class="op">(</span></span>
<span>  column_conflict <span class="op">=</span> <span class="st">"abort"</span>,</span>
<span>  implicit_keys <span class="op">=</span> <span class="st">"abort"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This will save some typing :</p>
<!-- For some reason this chunk makes markdown bug, so dirty fix -->
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/power_left_join.html">power_inner_join</a></span><span class="op">(</span></span>
<span>  <span class="va">male_penguins</span>,</span>
<span>  <span class="va">female_penguins</span>,</span>
<span>  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species"</span>, <span class="st">"island"</span><span class="op">)</span>,</span>
<span>  check <span class="op">=</span> <span class="va">dev_specs</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: The following columns are conflicted and their conflicts are not handled: </span></span>
<span><span class="co">#&gt; 'name', 'flipper_length_mm', 'body_mass_g'</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="handle-column-conflict">Handle column conflict<a class="anchor" aria-label="anchor" href="#handle-column-conflict"></a>
</h2>
<p>We saw above how to fail when encountering column conflict, here we show how to handle it.</p>
<p>To resolve conflicts between identically named join columns, set the <code>conflict</code> argument to a 2 argument function (or formula) that will take as arguments the 2 conflicting joined columns after the join.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="cn">NA</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>id <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">4</span>, value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">22</span>, <span class="fl">32</span>, <span class="fl">42</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/power_left_join.html">power_left_join</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, by <span class="op">=</span> <span class="st">"id"</span>, conflict <span class="op">=</span> <span class="va">`+`</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 2</span></span>
<span><span class="co">#&gt;      id value</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1    NA</span></span>
<span><span class="co">#&gt; 2     2    NA</span></span>
<span><span class="co">#&gt; 3     3    62</span></span></code></pre></div>
<p>Coalescing is the most common use case and we provide the functions <code><a href="reference/coalesce_xy.html">coalesce_xy()</a></code> and <code><a href="reference/coalesce_xy.html">coalesce_yx()</a></code> to ease this task (both wrapped around <code><a href="https://dplyr.tidyverse.org/reference/coalesce.html" class="external-link">dplyr::coalesce()</a></code>).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/power_left_join.html">power_left_join</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, by <span class="op">=</span> <span class="st">"id"</span>, conflict <span class="op">=</span> <span class="va">coalesce_xy</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 2</span></span>
<span><span class="co">#&gt;      id value</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1    10</span></span>
<span><span class="co">#&gt; 2     2    22</span></span>
<span><span class="co">#&gt; 3     3    30</span></span>
<span></span>
<span><span class="fu"><a href="reference/power_left_join.html">power_left_join</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, by <span class="op">=</span> <span class="st">"id"</span>, conflict <span class="op">=</span> <span class="va">coalesce_yx</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 2</span></span>
<span><span class="co">#&gt;      id value</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1    10</span></span>
<span><span class="co">#&gt; 2     2    22</span></span>
<span><span class="co">#&gt; 3     3    32</span></span></code></pre></div>
<p>Note that the function is operating on vectors by default, not rowwise, however we can make it work rowwise by using <code>rw</code> in the lhs of the formula.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/power_left_join.html">power_left_join</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, by <span class="op">=</span> <span class="st">"id"</span>, conflict <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">.x</span>, <span class="va">.y</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 2</span></span>
<span><span class="co">#&gt;      id value</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1    94</span></span>
<span><span class="co">#&gt; 2     2    94</span></span>
<span><span class="co">#&gt; 3     3    94</span></span>
<span></span>
<span><span class="fu"><a href="reference/power_left_join.html">power_left_join</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, by <span class="op">=</span> <span class="st">"id"</span>, conflict <span class="op">=</span> <span class="va">rw</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">.x</span>, <span class="va">.y</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 2</span></span>
<span><span class="co">#&gt;      id value</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1    10</span></span>
<span><span class="co">#&gt; 2     2    22</span></span>
<span><span class="co">#&gt; 3     3    62</span></span></code></pre></div>
<p>If you need finer control, <code>conflict</code> can also be a named list of such functions, formulas or special values, each to be applied on the relevant pair of conflicted columns.</p>
</div>
<div class="section level2">
<h2 id="preprocess-inputs">Preprocess inputs<a class="anchor" aria-label="anchor" href="#preprocess-inputs"></a>
</h2>
<p>Traditionally key columns need to be repeated when preprocessing inputs before a join, which is an annoyance and an opportunity for mistakes. With {powerjoin} we can do :</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/power_left_join.html">power_inner_join</a></span><span class="op">(</span></span>
<span>  <span class="va">male_penguins</span> <span class="op">%&gt;%</span> <span class="fu"><a href="reference/preprocess_inputs.html">select_keys_and</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span>,</span>
<span>  <span class="va">female_penguins</span> <span class="op">%&gt;%</span> <span class="fu"><a href="reference/preprocess_inputs.html">select_keys_and</a></span><span class="op">(</span>female_name <span class="op">=</span> <span class="va">name</span><span class="op">)</span>,</span>
<span>  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species"</span>, <span class="st">"island"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 4</span></span>
<span><span class="co">#&gt;   species island name    female_name</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;      </span></span>
<span><span class="co">#&gt; 1 Gentoo  Biscoe Giordan Alonda     </span></span>
<span><span class="co">#&gt; 2 Gentoo  Biscoe Giordan Mishayla   </span></span>
<span><span class="co">#&gt; 3 Adelie  Dream  Reiner  Ola</span></span></code></pre></div>
<p>For semi joins, just omit arguments to <code><a href="reference/preprocess_inputs.html">select_keys_and()</a></code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/power_left_join.html">power_inner_join</a></span><span class="op">(</span></span>
<span>  <span class="va">male_penguins</span>,</span>
<span>  <span class="va">female_penguins</span> <span class="op">%&gt;%</span> <span class="fu"><a href="reference/preprocess_inputs.html">select_keys_and</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species"</span>, <span class="st">"island"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 5</span></span>
<span><span class="co">#&gt;   name    species island flipper_length_mm body_mass_g</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;              &lt;int&gt;       &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Giordan Gentoo  Biscoe               222        5250</span></span>
<span><span class="co">#&gt; 2 Giordan Gentoo  Biscoe               222        5250</span></span>
<span><span class="co">#&gt; 3 Reiner  Adelie  Dream                185        3650</span></span></code></pre></div>
<p>We could also aggregate on keys before the join, without the need for any <code>group_by()</code>/<code>ungroup()</code> gymnastics :</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/power_left_join.html">power_left_join</a></span><span class="op">(</span></span>
<span>  <span class="va">male_penguins</span> <span class="op">%&gt;%</span> <span class="fu"><a href="reference/preprocess_inputs.html">summarize_by_keys</a></span><span class="op">(</span>male_weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">body_mass_g</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="va">female_penguins</span> <span class="op">%&gt;%</span> <span class="fu"><a href="reference/preprocess_inputs.html">summarize_by_keys</a></span><span class="op">(</span>female_weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">body_mass_g</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species"</span>, <span class="st">"island"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 4</span></span>
<span><span class="co">#&gt;   species island    male_weight female_weight</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;           &lt;dbl&gt;         &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie  Dream            3650          3600</span></span>
<span><span class="co">#&gt; 2 Adelie  Torgersen        3900            NA</span></span>
<span><span class="co">#&gt; 3 Gentoo  Biscoe           5250          4625</span></span></code></pre></div>
<p><code><a href="reference/preprocess_inputs.html">pack_along_keys()</a></code> packs given columns, or all non key columns by default, into a data frame column named by the <code>name</code> argument, it’s useful to namespace the data and avoid conflicts</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/power_left_join.html">power_left_join</a></span><span class="op">(</span></span>
<span>  <span class="va">male_penguins</span> <span class="op">%&gt;%</span> <span class="fu"><a href="reference/preprocess_inputs.html">pack_along_keys</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"m"</span><span class="op">)</span>,</span>
<span>  <span class="va">female_penguins</span> <span class="op">%&gt;%</span> <span class="fu"><a href="reference/preprocess_inputs.html">pack_along_keys</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"f"</span><span class="op">)</span>,</span>
<span>  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species"</span>, <span class="st">"island"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 4</span></span>
<span><span class="co">#&gt;   species island    m$name $flipper_length… $body_mass_g f$name $flipper_length…</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;             &lt;int&gt;        &lt;int&gt; &lt;chr&gt;             &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Gentoo  Biscoe    Giord…              222         5250 Alonda              211</span></span>
<span><span class="co">#&gt; 2 Gentoo  Biscoe    Giord…              222         5250 Misha…              215</span></span>
<span><span class="co">#&gt; 3 Adelie  Torgersen Lynden              190         3900 &lt;NA&gt;                 NA</span></span>
<span><span class="co">#&gt; 4 Adelie  Dream     Reiner              185         3650 Ola                 190</span></span></code></pre></div>
<p>We have more of these, all variants of tidyverse functions :</p>
<ul>
<li>
<code><a href="reference/preprocess_inputs.html">nest_by_keys()</a></code> nests given columns, or all by default, if <code>name</code> is given a single list column of data frames is created</li>
<li>
<code><a href="reference/preprocess_inputs.html">complete_keys()</a></code> expands the key columns, so all combinations are present, filling the rest of the new rows with <code>NA</code>s. Absent factor levels are expanded as well.</li>
</ul>
<!-- * `pivot_wider_by_keys()` and `pivot_longer_by_keys()` assume the "id" columns are the keys --><p>These functions do not modify the data but add an attribute that will be processed by the join function later on, so no function should be used on top of them.</p>
</div>
<div class="section level2">
<h2 id="fuzzy-joins">Fuzzy joins<a class="anchor" aria-label="anchor" href="#fuzzy-joins"></a>
</h2>
<p>To do fuzzy joins we use formulas in the <code>by</code> argument, in this formula we use, <code>.x</code> and <code>.y</code> to describe the left and right tables. This is very flexible but can be costly since a cartesian product is computed.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/power_left_join.html">power_inner_join</a></span><span class="op">(</span></span>
<span>    <span class="va">male_penguins</span> <span class="op">%&gt;%</span> <span class="fu"><a href="reference/preprocess_inputs.html">select_keys_and</a></span><span class="op">(</span>male_name <span class="op">=</span> <span class="va">name</span><span class="op">)</span>,</span>
<span>    <span class="va">female_penguins</span> <span class="op">%&gt;%</span> <span class="fu"><a href="reference/preprocess_inputs.html">select_keys_and</a></span><span class="op">(</span>female_name <span class="op">=</span> <span class="va">name</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">~</span><span class="va">.x</span><span class="op">$</span><span class="va">flipper_length_mm</span> <span class="op">&lt;</span> <span class="va">.y</span><span class="op">$</span><span class="va">flipper_length_mm</span>, <span class="op">~</span><span class="va">.x</span><span class="op">$</span><span class="va">body_mass_g</span> <span class="op">&gt;</span> <span class="va">.y</span><span class="op">$</span><span class="va">body_mass_g</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 6</span></span>
<span><span class="co">#&gt;   flipper_length_mm.x body_mass_g.x male_name flipper_length_mm.y body_mass_g.y</span></span>
<span><span class="co">#&gt;                 &lt;int&gt;         &lt;int&gt; &lt;chr&gt;                   &lt;dbl&gt;         &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1                 185          3650 Reiner                    190          3600</span></span>
<span><span class="co">#&gt; # … with 1 more variable: female_name &lt;chr&gt;</span></span></code></pre></div>
<p>We might also mix fuzzy joins with regular joins :</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/power_left_join.html">power_inner_join</a></span><span class="op">(</span></span>
<span>    <span class="va">male_penguins</span> <span class="op">%&gt;%</span> <span class="fu"><a href="reference/preprocess_inputs.html">select_keys_and</a></span><span class="op">(</span>male_name <span class="op">=</span> <span class="va">name</span><span class="op">)</span>,</span>
<span>    <span class="va">female_penguins</span> <span class="op">%&gt;%</span> <span class="fu"><a href="reference/preprocess_inputs.html">select_keys_and</a></span><span class="op">(</span>female_name <span class="op">=</span> <span class="va">name</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"island"</span>, <span class="op">~</span><span class="va">.x</span><span class="op">$</span><span class="va">flipper_length_mm</span> <span class="op">&gt;</span> <span class="va">.y</span><span class="op">$</span><span class="va">flipper_length_mm</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 5</span></span>
<span><span class="co">#&gt;   island flipper_length_mm.x male_name flipper_length_mm.y female_name</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                &lt;int&gt; &lt;chr&gt;                   &lt;dbl&gt; &lt;chr&gt;      </span></span>
<span><span class="co">#&gt; 1 Biscoe                 222 Giordan                   211 Alonda     </span></span>
<span><span class="co">#&gt; 2 Biscoe                 222 Giordan                   215 Mishayla</span></span></code></pre></div>
<p>Finally we might want to create a column with a value used in the comparison, in that case we will use <code>&lt;-</code> in the formula (several times if needed)`:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/power_left_join.html">power_inner_join</a></span><span class="op">(</span></span>
<span>    <span class="va">male_penguins</span> <span class="op">%&gt;%</span> <span class="fu"><a href="reference/preprocess_inputs.html">select_keys_and</a></span><span class="op">(</span>male_name <span class="op">=</span> <span class="va">name</span><span class="op">)</span>,</span>
<span>    <span class="va">female_penguins</span> <span class="op">%&gt;%</span> <span class="fu"><a href="reference/preprocess_inputs.html">select_keys_and</a></span><span class="op">(</span>female_name <span class="op">=</span> <span class="va">name</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="op">~</span> <span class="op">(</span><span class="va">mass_ratio</span> <span class="op">&lt;-</span> <span class="va">.y</span><span class="op">$</span><span class="va">body_mass_g</span> <span class="op">/</span> <span class="va">.x</span><span class="op">$</span><span class="va">body_mass_g</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1.2</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 5</span></span>
<span><span class="co">#&gt;   body_mass_g.x male_name body_mass_g.y female_name mass_ratio</span></span>
<span><span class="co">#&gt;           &lt;int&gt; &lt;chr&gt;             &lt;int&gt; &lt;chr&gt;            &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1          3900 Lynden             4750 Mishayla          1.22</span></span>
<span><span class="co">#&gt; 2          3650 Reiner             4500 Alonda            1.23</span></span>
<span><span class="co">#&gt; 3          3650 Reiner             4750 Mishayla          1.30</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fill-unmatched-values">Fill unmatched values<a class="anchor" aria-label="anchor" href="#fill-unmatched-values"></a>
</h2>
<p>The <code>fill</code> argument is used to specify what to fill unmatched values with, note that missing values resulting from matches are not replaced.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, value2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="cn">NA</span><span class="op">)</span>, value3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/power_left_join.html">power_left_join</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, by <span class="op">=</span> <span class="st">"id"</span>, fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 3</span></span>
<span><span class="co">#&gt;      id value2 value3</span></span>
<span><span class="co">#&gt;   &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1      2     NA</span></span>
<span><span class="co">#&gt; 2     2     NA      3</span></span>
<span><span class="co">#&gt; 3     3      0      0</span></span>
<span></span>
<span><span class="fu"><a href="reference/power_left_join.html">power_left_join</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, by <span class="op">=</span> <span class="st">"id"</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>value2 <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 3</span></span>
<span><span class="co">#&gt;      id value2 value3</span></span>
<span><span class="co">#&gt;   &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1      2     NA</span></span>
<span><span class="co">#&gt; 2     2     NA      3</span></span>
<span><span class="co">#&gt; 3     3      0     NA</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="join-recursively">Join recursively<a class="anchor" aria-label="anchor" href="#join-recursively"></a>
</h2>
<p>The <code>x</code> and <code>y</code> arguments accept lists of data frames so one can do :</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span>, a <span class="op">=</span> <span class="st">"foo"</span><span class="op">)</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="st">"bar"</span><span class="op">)</span></span>
<span><span class="va">df3</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span>, c <span class="op">=</span> <span class="st">"baz"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/power_left_join.html">power_left_join</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, <span class="va">df3</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 4</span></span>
<span><span class="co">#&gt;      id a     b     c    </span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1     1 foo   bar   baz</span></span>
<span></span>
<span><span class="fu"><a href="reference/power_left_join.html">power_left_join</a></span><span class="op">(</span><span class="va">df1</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">df2</span>, <span class="va">df3</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 4</span></span>
<span><span class="co">#&gt;      id a     b     c    </span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1     1 foo   bar   baz</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="enhanced-keep-argument">Enhanced <code>keep</code> argument<a class="anchor" aria-label="anchor" href="#enhanced-keep-argument"></a>
</h2>
<p>By default, as in <em>{dplyr}</em>, key columns are merged and given names from the left table. In case of a fuzzy join columns that participate in a fuzzy join are kept from both sides.</p>
<p>We provide additional values <code>"left"</code>, <code>"right"</code>, <code>"both"</code> and <code>"none"</code> to choose which keys to keep or drop.</p>
</div>
<div class="section level2">
<h2 id="notes">Notes<a class="anchor" aria-label="anchor" href="#notes"></a>
</h2>
<p>This package supersedes the {safejoin} package which had an unfortunate homonym on CRAN and had a suboptimal interface and implementation.</p>
<p>Hadley Wickham, Romain François and David Robinson are credited for their work in {dplyr} and {fuzzyjoin} since this package contains some code copied from these packages.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=powerjoin" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/moodymudskipper/powerjoin/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/moodymudskipper/powerjoin/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing powerjoin</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Antoine Fabri <br><small class="roles"> Author, maintainer </small>  </li>
<li>RStudio <br><small class="roles"> Copyright holder, funder </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Antoine Fabri, RStudio.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
